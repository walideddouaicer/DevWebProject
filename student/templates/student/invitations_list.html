{% extends 'student/base.html' %}
{% load static %}

{% block title %}Invitations de Collaboration - ENSA Project Manager{% endblock %}

{% block breadcrumb_items %}
<span class="breadcrumb-separator">></span>
<span>Invitations de Collaboration</span>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'student/css/invitations_list.css' %}">
<link rel="stylesheet" href="{% static 'student/css/dashboard.css' %}">

{% endblock %}

{% block content %}
    <!-- Hero Section -->
    <div class="invitations-hero">
        <div class="hero-content">
            <div class="hero-text">
                <h1>
                    ğŸ¤ Centre de Collaboration
                </h1>
                <p style="margin: 0; opacity: 0.9; font-size: var(--text-xl); font-weight: 400;">
                    GÃ©rez vos invitations et dÃ©veloppez vos partenariats acadÃ©miques
                </p>
                
                <div class="hero-stats">
                    <div class="hero-stat">
                        <div class="hero-stat-number">{{ received_invitations|length }}</div>
                        <div class="hero-stat-label">ReÃ§ues</div>
                    </div>
                    <div class="hero-stat">
                        <div class="hero-stat-number">{{ sent_invitations|length }}</div>
                        <div class="hero-stat-label">EnvoyÃ©es</div>
                    </div>
                    <div class="hero-stat">
                        <div class="hero-stat-number">{{ accepted_collaborations|default:0 }}</div>
                        <div class="hero-stat-label">Actives</div>
                    </div>
                </div>
            </div>
            <div class="hero-illustration">ğŸ‘¥</div>
        </div>
    </div>

    <!-- Priority Alert -->
    {% if received_invitations %}
    <div class="priority-banner">
        <div class="priority-icon">{{ received_invitations|length }}</div>
        <div>
            <h3 style="margin: 0 0 var(--space-2) 0; font-size: var(--text-xl);">âš ï¸ Action Requise</h3>
            <p style="margin: 0; opacity: 0.9;">
                Vous avez {{ received_invitations|length }} invitation{{ received_invitations|length|pluralize }} 
                en attente de rÃ©ponse. Consultez-les pour ne pas manquer d'opportunitÃ©s de collaboration.
            </p>
        </div>
        <a href="#received" class="btn btn-secondary" style="background: rgba(255,255,255,0.2); border-color: transparent;">
            ğŸ‘ï¸ Voir Maintenant
        </a>
    </div>
    {% endif %}

    <!-- Invitations Workspace -->
    <div class="invitations-workspace">
        <!-- Received Invitations -->
        <div class="section-card" id="received">
            <div class="section-header">
                <h2 class="section-title">
                    ğŸ“¥ Invitations ReÃ§ues
                </h2>
                <span class="section-count">{{ received_invitations|length }}</span>
            </div>
            
            {% if received_invitations %}
                <div>
                    {% for invitation in received_invitations %}
                    <div class="invitation-item">
                        <div class="invitation-header">
                            <div style="flex: 1;">
                                <h4 class="project-title">{{ invitation.project.title }}</h4>
                                <div class="invitation-meta">
                                    <span class="meta-icon">ğŸ“‚</span>
                                    <span>{{ invitation.project.get_project_type_display }}</span>
                                    {% if invitation.project.module %}
                                    <span class="meta-icon">ğŸ“š</span>
                                    <span>{{ invitation.project.module.code }}</span>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="invitation-date">
                                ğŸ“… {{ invitation.created_at|date:"d/m/Y" }}
                            </div>
                        </div>
                        
                        <div class="sender-info">
                            <div class="sender-avatar">
                                {{ invitation.sender.user.first_name|first|default:invitation.sender.user.username|first|upper }}
                            </div>
                            <div class="sender-details">
                                <div class="sender-name">
                                    {{ invitation.sender.user.get_full_name|default:invitation.sender.user.username }}
                                </div>
                                <div class="sender-meta">
                                    <span>ğŸ†” {{ invitation.sender.student_id }}</span>
                                    <span>ğŸ¢ {{ invitation.sender.department }}</span>
                                </div>
                            </div>
                        </div>
                        
                        {% if invitation.project.description %}
                        <div class="project-description">
                            <strong>ğŸ“ Description du projet:</strong><br>
                            {{ invitation.project.description|truncatewords:20 }}
                        </div>
                        {% endif %}
                        
                        <div class="invitation-actions">
                            <a href="{% url 'student:respond_to_invitation' invitation.id 'accept' %}" class="btn btn-success">
                                âœ… Accepter la Collaboration
                            </a>
                            <a href="{% url 'student:respond_to_invitation' invitation.id 'reject' %}" class="btn btn-secondary">
                                âŒ DÃ©cliner Poliment
                            </a>
                            <a href="{% url 'student:project_detail' invitation.project.id %}" class="btn btn-ghost">
                                ğŸ‘ï¸ Voir le Projet
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ“¥</div>
                    <h3>Aucune invitation reÃ§ue</h3>
                    <p>
                        Vous n'avez actuellement aucune invitation de collaboration en attente.
                        Les invitations apparaÃ®tront ici lorsque d'autres Ã©tudiants vous proposeront 
                        de collaborer sur leurs projets.
                    </p>
                </div>
            {% endif %}
        </div>
        
        <!-- Sent Invitations -->
        <div class="section-card">
            <div class="section-header">
                <h2 class="section-title">
                    ğŸ“¤ Invitations EnvoyÃ©es
                </h2>
                <span class="section-count">{{ sent_invitations|length }}</span>
            </div>
            
            {% if sent_invitations %}
                <div>
                    {% for invitation in sent_invitations %}
                    <div class="invitation-item">
                        <div class="invitation-header">
                            <div style="flex: 1;">
                                <h4 class="project-title">{{ invitation.project.title }}</h4>
                                <div class="invitation-meta">
                                    <span class="meta-icon">ğŸ“‚</span>
                                    <span>{{ invitation.project.get_project_type_display }}</span>
                                    {% if invitation.project.module %}
                                    <span class="meta-icon">ğŸ“š</span>
                                    <span>{{ invitation.project.module.code }}</span>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="invitation-date">
                                ğŸ“… {{ invitation.created_at|date:"d/m/Y" }}
                            </div>
                        </div>
                        
                        <div class="sender-info">
                            <div class="sender-avatar">
                                {{ invitation.recipient.user.first_name|first|default:invitation.recipient.user.username|first|upper }}
                            </div>
                            <div class="sender-details">
                                <div class="sender-name">
                                    {{ invitation.recipient.user.get_full_name|default:invitation.recipient.user.username }}
                                </div>
                                <div class="sender-meta">
                                    <span>ğŸ†” {{ invitation.recipient.student_id }}</span>
                                    <span>ğŸ¢ {{ invitation.recipient.department }}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="status-display status-{{ invitation.status }}">
                            <span>
                                {% if invitation.status == 'pending' %}â³
                                {% elif invitation.status == 'accepted' %}âœ…
                                {% elif invitation.status == 'rejected' %}âŒ
                                {% endif %}
                                {{ invitation.get_status_display }}
                            </span>
                            {% if invitation.status == 'pending' %}
                                <small>En attente de rÃ©ponse...</small>
                            {% endif %}
                        </div>
                        
                        {% if invitation.status == 'pending' %}
                        <div class="invitation-actions">
                            <a href="{% url 'student:cancel_invitation' invitation.id %}" 
                               class="btn btn-danger btn-sm"
                               onclick="return confirm('ÃŠtes-vous sÃ»r de vouloir annuler cette invitation?')">
                                ğŸ—‘ï¸ Annuler l'Invitation
                            </a>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ“¤</div>
                    <h3>Aucune invitation envoyÃ©e</h3>
                    <p>
                        Vous n'avez envoyÃ© aucune invitation de collaboration.
                        CrÃ©ez un projet et invitez des collaborateurs depuis la page 
                        de dÃ©tails du projet.
                    </p>
                    <a href="{% url 'student:project_create' %}" class="btn btn-primary">
                        â• CrÃ©er un Projet
                    </a>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Guide Section -->
    <div class="guide-section">
        <div class="guide-header">
            <div class="guide-icon">ğŸ’¡</div>
            <div class="guide-content">
                <h3>Guide de Collaboration</h3>
                <p style="margin: 0; color: var(--text-secondary); font-size: var(--text-lg);">
                    Apprenez Ã  maximiser vos collaborations acadÃ©miques
                </p>
            </div>
        </div>
        
        <div class="guide-grid">
            <div class="guide-item">
                <div class="guide-item-title">
                    ğŸ“¥ Recevoir des invitations
                </div>
                <p style="margin: 0; color: var(--text-secondary); font-size: var(--text-sm); line-height: 1.6;">
                    Les autres Ã©tudiants peuvent vous inviter Ã  collaborer sur leurs projets. 
                    RÃ©pondez rapidement pour saisir les meilleures opportunitÃ©s.
                </p>
            </div>
            
            <div class="guide-item">
                <div class="guide-item-title">
                    ğŸ“¤ Envoyer des invitations
                </div>
                <p style="margin: 0; color: var(--text-secondary); font-size: var(--text-sm); line-height: 1.6;">
                    Depuis votre projet, ajoutez des collaborateurs pour enrichir votre Ã©quipe 
                    et bÃ©nÃ©ficier de compÃ©tences complÃ©mentaires.
                </p>
            </div>
            
            <div class="guide-item">
                <div class="guide-item-title">
                    ğŸ¤ Collaboration active
                </div>
                <p style="margin: 0; color: var(--text-secondary); font-size: var(--text-sm); line-height: 1.6;">
                    Une fois acceptÃ©e, participez activement au projet comme un membre 
                    Ã  part entiÃ¨re de l'Ã©quipe de dÃ©veloppement.
                </p>
            </div>
            
            <div class="guide-item">
                <div class="guide-item-title">
                    âš¡ RÃ©activitÃ© recommandÃ©e
                </div>
                <p style="margin: 0; color: var(--text-secondary); font-size: var(--text-sm); line-height: 1.6;">
                    RÃ©pondez dans les 48h aux invitations pour maintenir une dynamique 
                    positive et ne pas retarder les projets en cours.
                </p>
            </div>
        </div>
    </div>
{% endblock %}
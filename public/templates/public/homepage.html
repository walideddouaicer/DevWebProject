<!-- public/templates/public/homepage.html -->
{% extends 'public/base_public.html' %}
{% load static %}

{% block title %}ENSA Project Manager - Plateforme de Gestion de Projets Acad√©miques{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'public/css/homepage.css' %}">
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero">
    <div class="container">
        <div class="hero-content">
            <div class="hero-text">
                <h1>L'Avenir de la Gestion Acad√©mique</h1>
                <p>ENSA Project Manager r√©volutionne la fa√ßon dont les √©tudiants, enseignants et administrateurs collaborent sur les projets acad√©miques. Une plateforme intelligente, intuitive et puissante.</p>
                <div class="hero-buttons">
                    <a href="{% url 'public:features' %}" class="btn btn-primary">
                        <i class="fas fa-rocket"></i>
                        D√©couvrir la plateforme
                    </a>
                    {% if not user.is_authenticated %}
                        <a href="{% url 'accounts:signup_choice' %}" class="btn btn-outline">
                            <i class="fas fa-user-plus"></i>
                            S'inscrire maintenant
                        </a>
                    {% else %}
                        <a href="{% url 'smart_redirect' %}" class="btn btn-outline">
                            <i class="fas fa-tachometer-alt"></i>
                            Acc√©der au tableau de bord
                        </a>
                    {% endif %}
                </div>
            </div>
            <div class="hero-visual">
                <div class="hero-cards">
                    <div class="hero-card">
                        <h4><i class="fas fa-chart-line"></i> Analytics en Temps R√©el</h4>
                        <p>Suivez vos performances et progressions avec des tableaux de bord dynamiques.</p>
                    </div>
                    <div class="hero-card">
                        <h4><i class="fas fa-users"></i> Collaboration Fluide</h4>
                        <p>Travaillez en √©quipe avec des outils de collaboration avanc√©s.</p>
                    </div>
                    <div class="hero-card">
                        <h4><i class="fas fa-shield-alt"></i> S√©curit√© Maximale</h4>
                        <p>Vos donn√©es et projets sont prot√©g√©s par une s√©curit√© de niveau entreprise.</p>
                    </div>
                    <div class="hero-card">
                        <h4><i class="fas fa-mobile-alt"></i> Mobile-First</h4>
                        <p>Acc√©dez √† vos projets depuis n'importe quel appareil, n'importe o√π.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Stats Section -->
<section class="stats-section">
    <div class="container">
        <div class="stats-grid">
            <div class="stat-item">
                <span class="stat-number" data-count="{{ total_projects|default:'2547' }}">0</span>
                <span class="stat-label">Projets R√©alis√©s</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" data-count="{{ total_students|default:'1829' }}">0</span>
                <span class="stat-label">√âtudiants Actifs</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" data-count="{{ total_teachers|default:'156' }}">0</span>
                <span class="stat-label">Enseignants</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" data-count="98">0</span>
                <span class="stat-label">% Satisfaction</span>
            </div>
        </div>
    </div>
</section>

<!-- Features Showcase -->
<section class="features-showcase">
    <div class="container">
        <h2>Fonctionnalit√©s R√©volutionnaires</h2>
        <p class="features-subtitle">D√©couvrez les interfaces qui font d'ENSA Project Manager la r√©f√©rence en gestion de projets acad√©miques</p>
        
        <div class="features-slider">
            <div class="features-track" id="featuresTrack">
                <!-- Slide 1: Tableau de Bord √âtudiant -->
                <div class="feature-slide">
                    <div class="feature-content">
                        <h3>Tableau de Bord √âtudiant</h3>
                        <p>Interface compl√®te pour g√©rer vos projets acad√©miques avec suivi en temps r√©el de la progression, actions rapides et informations d√©taill√©es.</p>
                        <ul class="feature-list">
                            <li>Suivi de progression visuel avec barre de pourcentage</li>
                            <li>Actions rapides : Modifier, Supprimer, Valider</li>
                            <li>Gestion des jalons et livrables</li>
                            <li>Interface intuitive et moderne</li>
                            <li>Informations projet d√©taill√©es</li>
                        </ul>
                    </div>
                    <div class="feature-visual">
                        <div class="feature-mockup">
                            <!-- Student Dashboard Mockup -->
                            <div style="background: #2a2d47; padding: 0; border-radius: 15px; overflow: hidden; min-height: 300px;">
                                <!-- Header with gradient -->
                                <div style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 2rem; color: white;">
                                    <h3 style="margin: 0; font-size: 1.8rem; font-weight: 900;">Projet Exemple</h3>
                                    <div style="display: flex; gap: 0.5rem; margin: 1rem 0;">
                                        <span style="background: rgba(255,255,255,0.2); padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.8rem;">üîÑ En cours</span>
                                        <span style="background: rgba(255,255,255,0.2); padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.8rem;">üìö Module</span>
                                        <span style="background: rgba(255,255,255,0.2); padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.8rem;">üëë Propri√©taire</span>
                                    </div>
                                    <div style="margin-top: 1rem;">
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                            <span>Progression du Projet</span>
                                            <span>75%</span>
                                        </div>
                                        <div style="background: rgba(255,255,255,0.2); height: 8px; border-radius: 4px; overflow: hidden;">
                                            <div style="background: #00f2fe; height: 100%; width: 75%; border-radius: 4px;"></div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Content Cards -->
                                <div style="padding: 1.5rem;">
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                                        <div style="background: rgba(102, 126, 234, 0.1); padding: 1rem; border-radius: 8px; border-left: 3px solid #667eea;">
                                            <div style="color: #667eea; font-size: 0.8rem;">üë§ Propri√©taire</div>
                                            <div style="color: white; font-weight: 600;">√âtudiant ENSA</div>
                                        </div>
                                        <div style="background: rgba(102, 126, 234, 0.1); padding: 1rem; border-radius: 8px; border-left: 3px solid #667eea;">
                                            <div style="color: #667eea; font-size: 0.8rem;">üìÖ Date de Cr√©ation</div>
                                            <div style="color: white; font-weight: 600;">06/06/2025</div>
                                        </div>
                                    </div>
                                    <!-- Action Buttons -->
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.8rem;">
                                        <button style="background: #667eea; color: white; border: none; padding: 0.8rem; border-radius: 8px; font-size: 0.8rem;">‚úèÔ∏è Modifier le Projet</button>
                                        <button style="background: #2ecc71; color: white; border: none; padding: 0.8rem; border-radius: 8px; font-size: 0.8rem;">‚úÖ Soumettre pour Validation</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Slide 2: Interface Administrateur -->
                <div class="feature-slide">
                    <div class="feature-content">
                        <h3>Interface Administrateur</h3>
                        <p>Tableau de bord complet pour les administrateurs avec vue d'ensemble sur tous les projets, √©tudiants et statistiques syst√®me.</p>
                        <ul class="feature-list">
                            <li>Vue d'ensemble administrative compl√®te</li>
                            <li>Statistiques en temps r√©el</li>
                            <li>Gestion des utilisateurs et projets</li>
                            <li>Actions rapides int√©gr√©es</li>
                            <li>Monitoring syst√®me avanc√©</li>
                        </ul>
                    </div>
                    <div class="feature-visual">
                        <div class="feature-mockup">
                            <!-- Admin Dashboard Mockup -->
                            <div style="background: #2a2d47; padding: 0; border-radius: 15px; overflow: hidden; min-height: 300px;">
                                <!-- Header -->
                                <div style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 2rem; color: white;">
                                    <h3 style="margin: 0; font-size: 1.6rem; font-weight: 900;">üëã Bienvenue, Administrateur</h3>
                                    <p style="margin: 0.5rem 0 0 0; opacity: 0.9; font-size: 0.9rem;">Interface d'administration ENSA Project Manager</p>
                                </div>
                                <!-- Stats Grid -->
                                <div style="padding: 1.5rem;">
                                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                                        <div style="background: rgba(102, 126, 234, 0.1); padding: 1rem; border-radius: 8px; text-align: center;">
                                            <div style="color: #667eea; font-size: 1.5rem; font-weight: 900;">{{ total_projects|default:'29' }}</div>
                                            <div style="color: #b3b3b3; font-size: 0.8rem;">PROJETS TOTAUX</div>
                                        </div>
                                        <div style="background: rgba(79, 172, 254, 0.1); padding: 1rem; border-radius: 8px; text-align: center;">
                                            <div style="color: #4facfe; font-size: 1.5rem; font-weight: 900;">{{ total_students|default:'9' }}</div>
                                            <div style="color: #b3b3b3; font-size: 0.8rem;">√âTUDIANTS</div>
                                        </div>
                                        <div style="background: rgba(240, 147, 251, 0.1); padding: 1rem; border-radius: 8px; text-align: center;">
                                            <div style="color: #f093fb; font-size: 1.5rem; font-weight: 900;">{{ total_teachers|default:'4' }}</div>
                                            <div style="color: #b3b3b3; font-size: 0.8rem;">ENSEIGNANTS</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Slide 3: Collaboration & √âquipe -->
                <div class="feature-slide">
                    <div class="feature-content">
                        <h3>Collaboration & √âquipe</h3>
                        <p>Outils de collaboration avanc√©s pour g√©rer les √©quipes, suivre l'activit√© des projets et favoriser la communication entre membres.</p>
                        <ul class="feature-list">
                            <li>Gestion d'√©quipe intuitive</li>
                            <li>Suivi d'activit√© en temps r√©el</li>
                            <li>Syst√®me d'invitations collaborateurs</li>
                            <li>Statistiques de collaboration</li>
                            <li>Timeline d'activit√©s d√©taill√©e</li>
                        </ul>
                    </div>
                    <div class="feature-visual">
                        <div class="feature-mockup">
                            <!-- Team Collaboration Mockup -->
                            <div style="background: #2a2d47; padding: 1.5rem; border-radius: 15px; min-height: 300px;">
                                <!-- Team Section -->
                                <div style="background: rgba(102, 126, 234, 0.1); padding: 1.5rem; border-radius: 12px; margin-bottom: 1rem;">
                                    <h4 style="color: white; margin: 0 0 1rem 0; font-size: 1.2rem;">üë• √âquipe de Projet</h4>
                                    <div style="border-left: 4px solid #f39c12; padding-left: 1rem; margin-bottom: 1rem;">
                                        <div style="color: #667eea; font-size: 0.9rem; margin-bottom: 0.5rem;">üëë Propri√©taire du Projet</div>
                                        <div style="display: flex; align-items: center; gap: 1rem;">
                                            <div style="width: 40px; height: 40px; background: #f39c12; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">E</div>
                                            <div>
                                                <div style="color: white; font-weight: 600;">√âtudiant ENSA</div>
                                                <div style="color: #b3b3b3; font-size: 0.8rem;">G√©nie Informatique</div>
                                            </div>
                                        </div>
                                    </div>
                                    <button style="background: #667eea; color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 8px; font-size: 0.9rem; cursor: pointer;">‚ûï Ajouter des Collaborateurs</button>
                                </div>
                                <!-- Activity Feed -->
                                <div style="background: rgba(79, 172, 254, 0.1); padding: 1.5rem; border-radius: 12px;">
                                    <h4 style="color: white; margin: 0 0 1rem 0; font-size: 1.2rem;">üìä Activit√© du Projet</h4>
                                    <div>
                                        <div style="border-left: 3px solid #2ecc71; padding-left: 1rem; margin-bottom: 0.8rem;">
                                            <div style="color: #2ecc71; font-size: 0.8rem;">Jalon compl√©t√©</div>
                                            <div style="color: #b3b3b3; font-size: 0.8rem;">Il y a 2 jours</div>
                                        </div>
                                        <div style="border-left: 3px solid #3498db; padding-left: 1rem;">
                                            <div style="color: #3498db; font-size: 0.8rem;">Projet cr√©√©</div>
                                            <div style="color: #b3b3b3; font-size: 0.8rem;">Il y a 5 jours</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Slide 4: Centre d'√âvaluation -->
                <div class="feature-slide">
                    <div class="feature-content">
                        <h3>Centre d'√âvaluation</h3>
                        <p>Interface d√©di√©e aux enseignants pour √©valuer et valider les projets √©tudiants avec syst√®me de filtres avanc√© et statistiques compl√®tes.</p>
                        <ul class="feature-list">
                            <li>√âvaluation centralis√©e des projets</li>
                            <li>Syst√®me de filtres intelligent</li>
                            <li>Statistiques de validation en temps r√©el</li>
                            <li>Interface enseignant optimis√©e</li>
                            <li>Processus d'√©valuation streamlined</li>
                        </ul>
                    </div>
                    <div class="feature-visual">
                        <div class="feature-mockup">
                            <!-- Evaluation Center Mockup -->
                            <div style="background: #2a2d47; padding: 0; border-radius: 15px; overflow: hidden; min-height: 300px;">
                                <!-- Header -->
                                <div style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 2rem; color: white;">
                                    <h3 style="margin: 0; font-size: 1.6rem; font-weight: 900;">üìä Centre d'√âvaluation</h3>
                                    <p style="margin: 0.5rem 0 0 0; opacity: 0.9;">G√©rez et √©valuez tous les projets de vos √©tudiants</p>
                                </div>
                                <!-- Stats Cards -->
                                <div style="padding: 1.5rem;">
                                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                                        <div style="background: rgba(102, 126, 234, 0.1); padding: 1rem; border-radius: 8px; text-align: center;">
                                            <div style="color: #667eea; font-size: 1.8rem; font-weight: 900;">15</div>
                                            <div style="color: #b3b3b3; font-size: 0.7rem;">PROJETS</div>
                                        </div>
                                        <div style="background: rgba(240, 147, 251, 0.1); padding: 1rem; border-radius: 8px; text-align: center;">
                                            <div style="color: #f093fb; font-size: 1.8rem; font-weight: 900;">3</div>
                                            <div style="color: #b3b3b3; font-size: 0.7rem;">EN ATTENTE</div>
                                        </div>
                                        <div style="background: rgba(46, 204, 113, 0.1); padding: 1rem; border-radius: 8px; text-align: center;">
                                            <div style="color: #2ecc71; font-size: 1.8rem; font-weight: 900;">10</div>
                                            <div style="color: #b3b3b3; font-size: 0.7rem;">VALID√âS</div>
                                        </div>
                                        <div style="background: rgba(231, 76, 60, 0.1); padding: 1rem; border-radius: 8px; text-align: center;">
                                            <div style="color: #e74c3c; font-size: 1.8rem; font-weight: 900;">2</div>
                                            <div style="color: #b3b3b3; font-size: 0.7rem;">REJET√âS</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="slider-controls">
            <div class="slider-dot active" data-slide="0"></div>
            <div class="slider-dot" data-slide="1"></div>
            <div class="slider-dot" data-slide="2"></div>
            <div class="slider-dot" data-slide="3"></div>
        </div>
    </div>
</section>

<!-- Projects Section (Placeholder) -->
<!-- Projects Carousel Section - Replace the existing projects-section -->
<section class="projects-section">
    <div class="container">
        <h2>Projets √âtudiants en Vedette</h2>
        
        {% if featured_projects %}
            <div class="projects-carousel">
                <div class="projects-track" id="projectsTrack">
                    {% for project in featured_projects %}
                        <div class="project-card">
                            <div class="project-header">
                                <div class="project-icon">
                                    {% if project.project_type == 'stage_pfe' %}
                                        <i class="fas fa-graduation-cap"></i>
                                    {% elif project.project_type == 'module' %}
                                        <i class="fas fa-book"></i>
                                    {% elif project.project_type == 'stage_ingenieur' %}
                                        <i class="fas fa-cogs"></i>
                                    {% else %}
                                        <i class="fas fa-code"></i>
                                    {% endif %}
                                </div>
                                <div class="project-status">{{ project.get_project_type_display }}</div>
                            </div>
                            <h3 class="project-title">
                                <a href="{% url 'public:project_detail' project.id %}" style="text-decoration: none; color: inherit;">
                                    {{ project.title|truncatechars:50 }}
                                </a>
                            </h3>
                            <p class="project-description">
                                {{ project.display_description|truncatewords:20 }}
                            </p>
                            
                            <!-- Replace the technologies section in the template with this simpler version -->

                            <!-- Project Technologies (simplified approach) -->
                            {% if project.technologies %}
                            <div class="project-technologies">
                                <span class="tech-tag">
                                        <i class="fas fa-code"></i>
                                        {{ project.technologies|truncatechars:30 }}
                                </span>
                                </div>
                            {% endif %}
                            
                            <!-- Project Stats -->
                            <div class="project-stats">
                                <div class="stat-item">
                                    <i class="fas fa-heart text-red-500"></i>
                                    <span>{{ project.like_count }}</span>
                                </div>
                                <div class="stat-item">
                                    <i class="fas fa-eye"></i>
                                    <span>{{ project.view_count }}</span>
                                </div>
                                {% if project.deliverables.count %}
                                    <div class="stat-item">
                                        <i class="fas fa-file"></i>
                                        <span>{{ project.deliverables.count }}</span>
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="project-meta">
                                <div class="project-author">
                                    <div class="author-avatar">
                                        {{ project.student.user.first_name.0|default:'?' }}{{ project.student.user.last_name.0|default:'?' }}
                                    </div>
                                    <div>
                                        <div style="font-weight: 600; color: var(--text-primary);">
                                            {{ project.student.user.get_full_name|default:project.student.user.username }}
                                        </div>
                                        <div style="font-size: 0.8rem; color: var(--text-secondary);">
                                            {{ project.student.student_id }} ‚Ä¢ {{ project.student.department }}
                                        </div>
                                    </div>
                                </div>
                                <div class="project-actions">
                                    {% if project.public_demo_url %}
                                        <a href="{{ project.public_demo_url }}" target="_blank" class="action-btn" title="Voir la d√©mo">
                                            <i class="fas fa-external-link-alt"></i>
                                        </a>
                                    {% endif %}
                                    {% if project.public_github_url %}
                                        <a href="{{ project.public_github_url }}" target="_blank" class="action-btn" title="Code source">
                                            <i class="fab fa-github"></i>
                                        </a>
                                    {% endif %}
                                    <a href="{% url 'public:project_detail' project.id %}" class="view-btn">
                                        Voir Plus
                                    </a>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Call to Action -->
            <div style="text-align: center; margin-top: 3rem;">
                <a href="{% url 'public:projects_showcase' %}" class="btn btn-primary">
                    <i class="fas fa-rocket"></i>
                    D√©couvrir Tous les Projets
                </a>
            </div>
        {% else %}
            <!-- Fallback if no projects -->
            <div class="projects-placeholder">
                <i class="fas fa-rocket"></i>
                <h3>Bient√¥t des Projets Innovants</h3>
                <p>Les √©tudiants ENSA travaillent sur des projets exceptionnels qui seront bient√¥t partag√©s ici. Restez connect√©s!</p>
            </div>
        {% endif %}
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    // Counter Animation
    function animateCounters() {
        const counters = document.querySelectorAll('[data-count]');
        
        counters.forEach(counter => {
            const target = parseInt(counter.getAttribute('data-count'));
            const duration = 2000;
            const increment = target / (duration / 16);
            let current = 0;

            const updateCounter = () => {
                if (current < target) {
                    current += increment;
                    counter.textContent = Math.floor(current);
                    requestAnimationFrame(updateCounter);
                } else {
                    counter.textContent = target;
                }
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        updateCounter();
                        observer.unobserve(entry.target);
                    }
                });
            });

            observer.observe(counter);
        });
    }

    // Features Slider
    function initFeaturesSlider() {
        const track = document.getElementById('featuresTrack');
        const dots = document.querySelectorAll('.slider-dot');
        let currentSlide = 0;

        dots.forEach((dot, index) => {
            dot.addEventListener('click', () => {
                currentSlide = index;
                updateSlider();
            });
        });

        function updateSlider() {
            track.style.transform = `translateX(-${currentSlide * 25}%)`;
            
            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentSlide);
            });
        }

        // Auto-slide
        setInterval(() => {
            currentSlide = (currentSlide + 1) % 4;
            updateSlider();
        }, 6000);
    }

    // Scroll Animations
    function initScrollAnimations() {
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        // Observe elements
        document.querySelectorAll('.hero-card, .stat-item').forEach(el => {
            el.style.opacity = '0';
            el.style.transform = 'translateY(30px)';
            el.style.transition = 'all 0.6s ease';
            observer.observe(el);
        });
    }

    // Projects Carousel
    function initProjectsCarousel() {
        const track = document.getElementById('projectsTrack');
        const carousel = document.querySelector('.projects-carousel');
        
        if (!track || !carousel) return; // Exit if elements don't exist
        
        let currentIndex = 0;
        const cardWidth = 370; // 350px + 20px gap
        const visibleCards = Math.floor(carousel.offsetWidth / cardWidth);
        const totalCards = track.children.length;
        const maxIndex = Math.max(0, totalCards - visibleCards);
        let isMouseOverCarousel = false;

        function updateCarousel() {
            track.style.transform = `translateX(-${currentIndex * cardWidth}px)`;
        }

        function moveToNext() {
            if (currentIndex < maxIndex) {
                currentIndex++;
                updateCarousel();
            }
        }

        function moveToPrev() {
            if (currentIndex > 0) {
                currentIndex--;
                updateCarousel();
            }
        }

        // Mouse wheel navigation
        function handleWheelScroll(e) {
            if (!isMouseOverCarousel) return;
            
            e.preventDefault(); // Prevent page scroll
            e.stopPropagation();
            
            // Determine scroll direction
            const delta = e.deltaY || e.detail || e.wheelDelta;
            
            if (delta > 0) {
                // Scrolling down/right - move to next
                moveToNext();
            } else {
                // Scrolling up/left - move to previous
                moveToPrev();
            }
        }

        // Track mouse enter/leave for the carousel
        carousel.addEventListener('mouseenter', () => {
            isMouseOverCarousel = true;
            carousel.style.cursor = 'grab';
            // Add visual indicator that scrolling is available
            carousel.style.boxShadow = '0 0 20px rgba(102, 126, 234, 0.3)';
            carousel.style.transition = 'box-shadow 0.3s ease';
        });

        carousel.addEventListener('mouseleave', () => {
            isMouseOverCarousel = false;
            carousel.style.cursor = 'default';
            carousel.style.boxShadow = 'none';
        });

        // Add wheel event listeners
        carousel.addEventListener('wheel', handleWheelScroll, { passive: false });
        
        // Fallback for older browsers
        carousel.addEventListener('DOMMouseScroll', handleWheelScroll); // Firefox
        carousel.addEventListener('mousewheel', handleWheelScroll); // Webkit

        // Auto-slide (optional - you can remove this if you want only manual control)
        let autoSlideInterval;
        
        function startAutoSlide() {
            autoSlideInterval = setInterval(() => {
                if (!isMouseOverCarousel && totalCards > visibleCards) {
                    if (currentIndex < maxIndex) {
                        currentIndex++;
                    } else {
                        currentIndex = 0; // Loop back to start
                    }
                    updateCarousel();
                }
            }, 4000); // Change slide every 4 seconds
        }

        function stopAutoSlide() {
            if (autoSlideInterval) {
                clearInterval(autoSlideInterval);
            }
        }

        // Start auto-slide
        if (totalCards > visibleCards) {
            startAutoSlide();
        }

        // Pause auto-slide when hovering
        carousel.addEventListener('mouseenter', stopAutoSlide);
        carousel.addEventListener('mouseleave', () => {
            if (totalCards > visibleCards) {
                startAutoSlide();
            }
        });

        // Initial state
        updateCarousel();

        // Handle window resize
        window.addEventListener('resize', () => {
            const newVisibleCards = Math.floor(carousel.offsetWidth / cardWidth);
            const newMaxIndex = Math.max(0, totalCards - newVisibleCards);
            if (currentIndex > newMaxIndex) {
                currentIndex = newMaxIndex;
            }
            updateCarousel();
        });

        // Touch support for mobile devices
        let startX = 0;
        let currentX = 0;
        let isDragging = false;

        carousel.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            isDragging = true;
            carousel.style.cursor = 'grabbing';
        });

        carousel.addEventListener('touchmove', (e) => {
            if (!isDragging) return;
            e.preventDefault();
            currentX = e.touches[0].clientX;
        });

        carousel.addEventListener('touchend', () => {
            if (!isDragging) return;
            isDragging = false;
            carousel.style.cursor = 'grab';
            
            const diffX = startX - currentX;
            const threshold = 50; // Minimum distance for swipe
            
            if (Math.abs(diffX) > threshold) {
                if (diffX > 0) {
                    moveToNext(); // Swipe left - next
                } else {
                    moveToPrev(); // Swipe right - previous
                }
            }
        });
    }

    // Update the main initialization function to include the projects carousel
    document.addEventListener('DOMContentLoaded', function() {
        animateCounters();
        initFeaturesSlider();
        initProjectsCarousel();
        initScrollAnimations();

        // Smooth scrolling for navigation
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Add loading animation
        document.body.style.opacity = '0';
        setTimeout(() => {
            document.body.style.transition = 'opacity 0.5s ease';
            document.body.style.opacity = '1';
        }, 100);
    });
</script>
{% endblock %}